# 产品需求文档（PRD）——批量图片水印工具

- **产品名称**：Watermark Studio
- **版本**：v1.0（含可选高级功能标注）
- **目标**：支持用户批量为图片添加文本或图片水印，提供所见即所得的实时预览与灵活导出能力。
- **目标用户**：电商运营、品牌方、设计师、内容创作者、法务/合规团队。
- **核心价值**：提升批量上水印效率，统一品牌曝光与版权保护，减少人工出错。

---

## 一、范围与目标

- **MVP 范围**
  - 图片导入（单张/批量/文件夹）、缩略图列表展示
  - 文本水印（内容、透明度、位置、大小、实时预览）
  - 导出为 JPEG/PNG（防原地覆盖、命名规则）
  - 模板保存/加载与最近配置自动恢复
- **高级功能（可选）**
  - 支持更多输入格式（BMP、TIFF）、PNG 透明通道（必需）
  - 文本字体设置（字体、字号、粗体、斜体）、颜色选择、阴影/描边
  - 图片水印（含透明通道 PNG）
  - 水印旋转
  - 导出 JPEG 质量调节、导出尺寸缩放

---

## 二、用户场景与用户故事

- 作为电商运营，我需要一次性给 300 张商品图添加品牌水印，并统一导出到新文件夹，避免覆盖原图。
- 作为品牌方，我需要用企业 Logo 作为图片水印，置于右下角，透明度 40%，并保存为模板给同事复用。
- 作为设计师，我需要根据不同背景调整文字颜色、阴影/描边，以确保在复杂背景下可读。
- 作为合规人员，我需要预设九宫格位置快速定位水印，并锁定位置防误拖拽。

---

## 三、功能需求

### 1. 文件处理

#### 1.1 导入图片
- 必须支持：
  - 单张图片拖拽到界面导入
  - 通过文件选择器导入单张/多张图片
  - 支持选择整个文件夹导入（递归可选，默认仅当前层）
- 展示：
  - 在侧栏/底栏显示已导入图片列表：缩略图+文件名
  - 显示导入数量、失败计数（不支持的格式或损坏）
  - 列表项支持点击切换预览焦点，支持多选（为未来批量差异化设置预留，当前统一设置）
- 交互与性能：
  - 大批量导入时异步生成缩略图，先显示文件名/占位图
  - 提供"清空列表""移除选中"操作
  - 去重策略：同一路径文件仅保留一条，重复导入则忽略并提示计数

#### 1.2 支持格式
- 输入格式（必须）：JPEG、PNG（PNG 必须支持透明通道）
- 输入格式（强烈建议）：BMP、TIFF
- 输出格式（可选项二选一）：JPEG 或 PNG

#### 1.3 导出图片
- 导出目录：
  - 用户必须选择一个输出文件夹
  - 默认禁止导出到原文件夹；如用户强制选择相同文件夹，需弹出风险提示并要求二次确认（默认取消）
- 文件命名规则：
  - 保留原文件名
  - 添加自定义前缀（如 `wm_`）
  - 添加自定义后缀（如 `_watermarked`）
  - 冲突处理：如目标已存在同名文件，自动在末尾添加递增序号（_1, _2...）
- JPEG 质量（高级，可选）：
  - 0–100 滑块，默认 85；展示预估文件体积分级提示（粗略）
- 尺寸调整（高级，可选）：
  - 支持按宽度、高度、百分比缩放，保持纵横比（可解锁自由缩放）
  - 提供常用预设：50%、75%、1080px 宽等
  - 提醒：缩放先于水印绘制，预览保持一致

### 2. 水印类型

#### 2.1 文本水印（MVP 核心）
- 内容：自由输入文本（支持多行，换行符生效）
- 字体（高级，可选）：系统字体下拉；字号、粗体、斜体
- 颜色（高级，可选）：调色板/拾色器，支持 HEX/RGB；提供常用色快捷项
- 透明度：0–100%（内部采用 0–1 alpha）
- 大小：支持字号/缩放比例控制
- 样式（高级，可选）：
  - 阴影：颜色、偏移、模糊强度、透明度
  - 描边：颜色、宽度、透明度
- 排版：支持行间距、字间距（可选）

#### 2.2 图片水印（高级，可选）
- 选择本地图片（建议仅支持 PNG 优先，必须支持带透明通道的 PNG）
- 缩放：按比例或自由缩放
- 透明度：0–100%
- 占位对齐：与文本水印相同的九宫格预设与拖拽

### 3. 水印布局与样式

#### 3.1 实时预览
- 任何调整（内容/样式/位置/透明度/尺寸/旋转）应在主预览窗口即时更新
- 支持点击图片列表切换预览目标；预览应用当前配置但不立即写回硬盘
- 提供"适配窗口/原尺寸/缩放比例"预览模式；显示当前缩放倍率

#### 3.2 位置
- 预设位置：九宫格（左上、上中、右上、中左、中心、中右、左下、下中、右下）
- 手动拖拽：
  - 鼠标拖拽将水印移动到任意位置
  - 支持吸附（对齐边缘与安全边距，开启/关闭）
  - 支持"锁定位置"防误操作
- 边距：支持设置距边框的内边距（px 或 %）

#### 3.3 旋转（高级，可选）
- 滑块或输入框设置任意角度（-180° ~ 180°）
- 显示当前角度，支持重置为 0°

---

## 四、配置管理

### 4.1 水印模板
- 可将当前所有设置保存为模板，包括：
  - 文本/图片水印类型与内容/源文件
  - 字体、字号、颜色、透明度、样式（阴影/描边）
  - 位置、边距、旋转、缩放策略
  - 导出设置（格式、质量、命名规则、尺寸）
- 模板管理：
  - 列表查看、重命名、应用、删除
  - 保存同名处理：提示覆盖或另存为
- 启动加载：
  - 默认加载上一次关闭时的设置
  - 首次启动加载"默认模板"（内置）

---

## 五、信息架构与主要界面

- 顶部工具栏：
  - 导入（文件/文件夹）、导出设置、开始导出、模板（保存/加载/管理）、撤销/重做（可选）
- 左侧（或底部）列表：
  - 缩略图+文件名，导入计数、筛选（全部/已选/失败）
- 右侧设置面板（分为标签页或折叠区）：
  - 水印：文本/图片切换，内容输入/图片选择，透明度、大小、旋转（可选）
  - 样式（高级）：字体、颜色、阴影、描边
  - 布局：九宫格、拖拽启用、锁定、边距、吸附
  - 导出：格式、质量（JPEG）、命名规则、尺寸缩放、输出目录
- 中央主预览区：
  - 画布操作：拖动、缩放、网格/安全边距参考线（可选）
  - 实时渲染当前选中图片的效果

---

## 六、数据与状态

- 图片项结构（示例）
  - id、源路径、文件名、缩略图缓存、本地读取状态、错误状态
- 水印配置结构
  - type: text | image
  - textConfig: content、fontFamily、fontSize、fontWeight、fontStyle、color、opacity、shadow、stroke、letterSpacing、lineHeight
  - imageConfig: filePath、naturalSize、scale、opacity
  - layout: positionPreset、offsetX、offsetY、padding、locked、snap
  - transform: rotation
- 导出配置结构
  - format: jpeg | png、jpegQuality、resize: {mode: width | height | percent | none, value}
  - naming: keepOriginal | prefix | suffix、prefixText、suffixText
  - outputDir、avoidOverwriteOriginal: true

---

## 七、非功能需求

- 性能：1,000 张 1080p 图片导入/预览不卡顿；生成缩略图异步；导出多线程/分批（UI 可展示进度）
- 稳定性：异常图片跳过并记录；导出失败可重试
- 可用性：关键操作可撤销（可选）；危险操作二次确认
- 跨平台：Windows/macOS（若为桌面端）；若为 Web，需在常见浏览器稳定运行
- 本地化：中文为主，保留英文国际化扩展点

---

## 八、边界与异常处理

- 不支持的输入格式：统计与提示，允许过滤掉并继续
- 损坏图片：标记为失败，不阻断其他图片处理
- 输出目录未写权限：立即阻止并提示
- 导出与原目录相同：默认不允许，需二次确认
- 模板引用了不存在的图片水印源：应用时提示缺失并允许选择替代或忽略图片水印

---

## 九、验收标准（MVP）

- 成功导入 JPEG/PNG 多张图片，并在列表显示缩略图与文件名
- 文本水印可编辑内容、调节透明度、拖拽与九宫格定位，预览实时更新
- 导出为 JPEG 或 PNG 至指定目录，文件命名规则生效，不覆盖原图
- 模板可保存、加载；重启后自动恢复上次设置
- PNG 输入透明通道渲染正确；PNG 输出保留透明（若无背景）

---

## 十、分析与度量

- 指标：导入数量、导出成功率、平均导出耗时、模板使用率、撤销/重做使用率（可选）
- 诊断：错误类型分布（格式不支持、损坏、权限）

---

## 十一、风险与依赖

- 字体可用性因系统差异导致预览/导出不一致（方案：内置常用字体或字体回退）
- 大图批量处理内存与性能压力（方案：流式处理、分批、限制并发）
- 浏览器环境（若为 Web）对文件系统访问和多线程的限制（方案：File System Access API/Web Worker，或转桌面端）

---

## 十二、里程碑计划

- M1（核心可用，2–3 周）：导入/列表/预览、文本水印基础、九宫格+拖拽、导出、模板基础、自动恢复
- M2（体验增强，1–2 周）：PNG 透明、更多输入格式、JPEG 质量、尺寸缩放、吸附/边距、冲突命名优化
- M3（高级样式，1–2 周）：字体/颜色、阴影/描边、旋转、图片水印、进度与失败重试

---

## 十三、术语定义

- 九宫格位置：四角、四边中点、中心共 9 个预设锚点
- 透明度：显示强度，0% 完全透明，100% 完全不透明
- 模板：一组可命名并重复应用的完整水印与导出配置快照
